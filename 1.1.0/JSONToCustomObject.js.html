<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: JSONToCustomObject.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: JSONToCustomObject.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var Logger = require('./Logger.js');

var JSONToCustomObject = function (configuration) {
    this.log = Logger.create();
};

/**
 *
 * @param {Object} jsonobject - an object
 * @param {Object} customobject - an object that is expected to have meta information
 *  attached to it.  This meta information is obtained via getMetaInfo on the passed customobject.
 * @param attachUnknownProperties - if true, then properties that are not recognized will still be
 *  attached to the returned object, or; if the top level customobject has no meta information,
 *  then a copy of the passed jsonobject will be returned.
 * @returns {Object | null}
 */
JSONToCustomObject.prototype.transfertoObject = function(jsonobject, customobject, attachUnknownProperties) {
    if(typeof jsonobject === "string") {
        // This should not happen, primitives are set outside this.
        // Try to parse it as a json string
        try {
            jsonobject = JSON.parse(jsonobject);
        } catch(e) {
            this.log.warn(e);
        }
    }
    // First see if we can do this
    if(customobject["getMetaInfo"] &amp;&amp; typeof(customobject.getMetaInfo) === 'function' ) {
        for (var key in jsonobject) {
            // If the object is null or undefined (I don't think it can be undefined here...)
            // Just set the field on the customobject to null or undefined.
            if(jsonobject[key] === null || jsonobject[key] === undefined) {
                customobject[key] = jsonobject[key];
            } else {
                var metaInfo = customobject.getMetaInfo(key);
                if(metaInfo) {
                    // The field exists on the customObject.  Do some checks on type to
                    // make sure we set the field to the proper value.
                    if(this.isPrimitive(metaInfo)) {
                        // Hope for the same type?  There is the possibility
                        // of having different types that are compatible...
                        customobject[key] = jsonobject[key];
                    } else if(this.isArray(metaInfo)) {
                        var elementType = this.getArrayType(metaInfo);
                        var jsonArray = jsonobject[key];
                        // This must be an array.

                        // The json from remote-pay has this structure for arrays:
                        // foo: { elements : [ element ] }
                        // handle this here
                        if(jsonArray.hasOwnProperty("elements")) {
                            jsonArray = jsonArray.elements;
                        }
                        if(Array.isArray(jsonArray)) {
                            customobject[key] = [];
                            for (var count = 0; count &lt; jsonArray.length; count++) {
                                customobject[key][count] = new elementType;
                                var copied = this.transfertoObject(jsonArray[count], customobject[key][count], attachUnknownProperties);
                                if (copied) {
                                    customobject[key][count] = copied;
                                }
                            }
                        } else {
                            // Warn.  We will be tolerant...
                            this.log.warn("Passed json contains field " + key + " of type " + typeof jsonArray  +
                              ".  The field on the object is of type array.  No assignment will be made", jsonArray, jsonobject);
                            if(attachUnknownProperties) {
                                customobject["x_" + key] = jsonArray;
                            }
                        }
                    } else if(this.isObject(metaInfo)) {
                        // This is a base object.
                        customobject[key] = {};
                        var copied = this.transfertoObject(jsonobject[key], customobject[key], true);
                        if (copied) {
                            customobject[key] = copied;
                        }
                    } else {
                        var fieldType = metaInfo.type;
                        // Might be an enum.  Check here.
                        if(fieldType[jsonobject[key]]) {
                            // It is an 'enum', grab the enum value.
                            customobject[key] = fieldType[jsonobject[key]];
                        } else {
                            try {
                                // The field is not primitive, or an array, or an 'enum'
                                // Try to create an instance of the type
                                customobject[key] = new fieldType;
                            } catch (e) {
                                throw e;
                            }
                            var copied = this.transfertoObject(jsonobject[key], customobject[key], attachUnknownProperties);
                            if (copied) {
                                customobject[key] = copied;
                            }
                        }
                    }
                } else if(attachUnknownProperties) {
                    // Add the unknown information as properties.
                    customobject[key] = JSON.parse(JSON.stringify(jsonobject));
                }
            }
        }
    } else if(attachUnknownProperties) {
        return JSON.parse(JSON.stringify(jsonobject));
    }
    return null;
},

JSONToCustomObject.prototype.isPrimitive = function(metaInfo) {
    var variableType = metaInfo.type;
    return (
        variableType ===  String ||
        variableType ===  Number ||
        variableType ===  Boolean );
},

JSONToCustomObject.prototype.isArray = function(metaInfo) {
    var variableType = metaInfo.type;
    return ( variableType ===  Array );
},

JSONToCustomObject.prototype.isObject = function(metaInfo){
    var variableType = metaInfo.type;
    return ( variableType ===  Object );
},

JSONToCustomObject.prototype.getArrayType = function(metaInfo) {
    if(this.isArray(metaInfo)) {
        return metaInfo.elementType;
    }
},

/**
 * Not used much.  Could be here for a map, but really do not want to see a map...
 * @param metaInfo
 * @returns {string}
 */
JSONToCustomObject.prototype.getValueType = function(metaInfo) {
    return metaInfo.valueType;
}


//
// Expose the module.
//
if ('undefined' !== typeof module) {
    module.exports = JSONToCustomObject;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CardEntryMethods.html">CardEntryMethods</a></li><li><a href="Clover.html">Clover</a></li><li><a href="CloverConnectorImpl.html">CloverConnectorImpl</a></li><li><a href="CloverError.html">CloverError</a></li><li><a href="CloverID.html">CloverID</a></li><li><a href="CloverOAuth.html">CloverOAuth</a></li><li><a href="CloverOAuth2.html">CloverOAuth2</a></li><li><a href="DeviceContactInfo.html">DeviceContactInfo</a></li><li><a href="EndPointConfig.html">EndPointConfig</a></li><li><a href="Endpoints.html">Endpoints</a></li><li><a href="LanMethod.html">LanMethod</a></li><li><a href="RemoteMessageBuilder.html">RemoteMessageBuilder</a></li><li><a href="WebSocketDevice.html">WebSocketDevice</a></li><li><a href="XmlHttpSupport.html">XmlHttpSupport</a></li></ul><h3>Global</h3><ul><li><a href="global.html#DebugCloverConnectorListener">DebugCloverConnectorListener</a></li><li><a href="global.html#DelegateCloverConnectorListener">DelegateCloverConnectorListener</a></li><li><a href="global.html#KeyPress">KeyPress</a></li><li><a href="global.html#VoidReason">VoidReason</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Jan 31 2017 12:08:42 GMT-0700 (MST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
